import { Head, Steps, Split, SplitRight, themes } from 'mdx-deck'
import { FaTwitter } from 'react-icons/fa'
import MultiCodeBlock from './multi-code-block'
import flavors from './flavors.png'
import plan from './plan.png'
import alchemy from './alchemy.png'
import title from './title.png'
import babel from './babel.png'
import prettier from './prettier.png'
import disappointed from './disappointed.jpg'
import messi from './messi.jpg'
import guide from './guide.gif'
import pictures from './pictures.gif'

export const theme = {
  ...themes.condensed,
  ...themes.prism
}

<Head>
  <title>Code Block Alchemy</title>
  <link rel="icon" href="https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/237/alembic_2697.png" />
</Head>

<Footer>

<h4>
  <FaTwitter
    style={{
      verticalAlign: '-0.1em',
      marginRight: '0.5em'
    }}
    fill="#1da1f2"
  />
  @trevorblades
</h4>

</Footer>

<img
  src={alchemy} 
  style={{
    height: 100,
    marginBottom: '2em'
  }}
/>

<img
  src={title}
  style={{
    height: 120,
    marginBottom: '1em'
  }}
/>

## Building multi-language code samples

Trevor Blades, web developer at Apollo

---

# Developer experience

<img src={guide} style={{ maxHeight: 400 }} />

We create awesome documentation

---

# Code samples are important

<img src={pictures} style={{ maxHeight: 400 }} />

---

# TypeScript is popular

<img src={flavors} />

Developers want to see code samples written in TypeScript

---

# Our code samples

```js
import { ApolloClient, InMemoryCache } from "@apollo/client";

const client = new ApolloClient({
  cache: new InMemoryCache(),
  uri: "http://localhost:4000/"
});
```

Not written in TypeScript

---

# The challenge

<Steps>

1. Demonstrate how to use Apollo with TypeScript
1. Preserve JavaScript examples
1. Avoid writing the same thing twice

</Steps>

---

# Avoid writing the same thing twice

<Steps>

- TypeScript compiles to JavaScript
- Can read/edit the Markdown AST using Remark
- `tsc` runs in Node

</Steps>

---

# The plan

<img src={plan} style={{ maxHeight: 250 }} />

- Write code samples in TypeScript
- Remark plugin compiles TypeScript code blocks to JavaScript
- Render JavaScript samples alongside TypeScript ones

---

<div style={{ fontSize: '0.75em' }}>

```ts
import {
  ApolloClient,
  InMemoryCache,
  NormalizedCacheObject
} from "@apollo/client";

const client: ApolloClient<NormalizedCacheObject> = new ApolloClient({
  cache: new InMemoryCache(),
  uri: "http://localhost:4000/"
});
```

</div>

<div style={{ fontSize: '0.75em' }}>

<Steps>

<div>

```js
import { ApolloClient, InMemoryCache } from '@apollo/client';
const client = new ApolloClient({
    cache: new InMemoryCache(),
    uri: "http://localhost:4000/"
});
```

</div>

</Steps>

</div>

---

<img src={messi} style={{ maxHeight: 500 }} />

<Steps>

But what about a more complex example?

</Steps>

---

<div style={{ fontSize: '0.4em' }}>

```tsx
interface ProfileProps extends RouteComponentProps {}

const Profile: React.FC<ProfileProps> = () => {
  const { data, loading, error } = useQuery<GetMyTripsTypes.GetMyTrips, any>(
    GET_MY_TRIPS,
    { fetchPolicy: "network-only" }
  );
  if (loading) return <Loading />;
  if (error) return <p>ERROR: {error.message}</p>;
  if (data === undefined) return <p>ERROR</p>;

  return (
    <Fragment>
      <Header>My Trips</Header>
      {data.me && data.me.trips.length ? (
        data.me.trips.map((launch: any) => (
          <LaunchTile key={launch.id} launch={launch} />
        ))
      ) : (
        <p>You haven't booked any trips</p>
      )}
    </Fragment>
  );
}

export default Profile;
```

</div>

<div style={{ fontSize: '0.4em' }}>
  
<Steps>

<div>

```jsx
const Profile = () => {
    const { data, loading, error } = useQuery(GET_MY_TRIPS, { fetchPolicy: "network-only" });
    if (loading)
        return <Loading />;
    if (error)
        return <p>ERROR: {error.message}</p>;
    if (data === undefined)
        return <p>ERROR</p>;
    return (<Fragment>
      <Header>My Trips</Header>
      {data.me && data.me.trips.length ? (data.me.trips.map((launch) => (<LaunchTile key={launch.id} launch={launch}/>))) : (<p>You haven't booked any trips</p>)}
    </Fragment>);
};
export default Profile;
```

</div>

</Steps>

</div>

---

<img src={disappointed} style={{ maxHeight: 400 }} />

The TypeScript compiler doesn't care about your formatting

---

# Compiler

- Takes source code written in one language
- Outputs code in another language
- Typically, compilers like `tsc` or `gcc` produce code that is ready for excecution

---

# Transpiler

- Known as a "source-to-source" compiler
- Output is usually understandable by a human
- Output still has to go through a compiler to be run

---

<img src={babel} style={{ height: 150 }} />

<Steps>

- Can _transpile_ TypeScript using `@babel/preset-typescript`
- Doesn't have opinions about formatting
- Keeps whitespace intact using `retainLines` option

</Steps>

---

<Split>

<div>

TypeScript

<div style={{ fontSize: '0.4em' }}>

```tsx
interface ProfileProps extends RouteComponentProps {}

const Profile: React.FC<ProfileProps> = () => {
  const { data, loading, error } = useQuery<GetMyTripsTypes.GetMyTrips, any>(
    GET_MY_TRIPS,
    { fetchPolicy: "network-only" }
  );
  if (loading) return <Loading />;
  if (error) return <p>ERROR: {error.message}</p>;
  if (data === undefined) return <p>ERROR</p>;

  return (
    <Fragment>
      <Header>My Trips</Header>
      {data.me && data.me.trips.length ? (
        data.me.trips.map((launch: any) => (
          <LaunchTile key={launch.id} launch={launch} />
        ))
      ) : (
        <p>You haven't booked any trips</p>
      )}
    </Fragment>
  );
}

export default Profile;
```

</div>

</div>

Babel

<div style={{ fontSize: '0.4em' }}>

```jsx


const Profile = () => {
  const { data, loading, error } = useQuery(
  GET_MY_TRIPS,
  { fetchPolicy: "network-only" });

  if (loading) return <Loading />;
  if (error) return <p>ERROR: {error.message}</p>;
  if (data === undefined) return <p>ERROR</p>;

  return (
    <Fragment>
      <Header>My Trips</Header>
      {data.me && data.me.trips.length ?
      data.me.trips.map((launch) =>
      <LaunchTile key={launch.id} launch={launch} />) :


      <p>You haven't booked any trips</p>}

    </Fragment>);

};

export default Profile;
```

</div>

</Split>

---

# Almost there

- Pro: Retained same phrasing and intention
- Con: Empty space where TypeScript code used to be
- Con: Incorrect indentation and janky formatting in areas

If only the code looked a little...

---

<SplitRight>

<div style={{ fontSize: '0.4em' }}>

```jsx
const Profile = () => {
  const { data, loading, error } = useQuery(
    GET_MY_TRIPS,
    { fetchPolicy: "network-only" }
  );
  if (loading) return <Loading />;
  if (error) return <p>ERROR: {error.message}</p>;
  if (data === undefined) return <p>ERROR</p>;

  return (
    <Fragment>
      <Header>My Trips</Header>
      {data.me && data.me.trips.length ? (
        data.me.trips.map(launch => (
          <LaunchTile key={launch.id} launch={launch} />
        ))
      ) : (
        <p>You haven't booked any trips</p>
      )}
    </Fragment>
  );
};

export default Profile;
```

</div>

<img src={prettier} style={{ height: 250 }} />

âœ… Fixes indentation and excessive newlines

</SplitRight>

---

# Remark plugin

````md
Lorem ipsum dolor sit amet, consectetur adipiscing
elit, sed do eiusmod tempor incididunt ut labore
et dolore magna aliqua.

```ts
// TypeScript code block
```

<-- insert JS code block here
````

---

<MultiCodeBlock>

```ts
// TypeScript code block
```

```js
// JavaScript code block
```

</MultiCodeBlock>

---

# Acknowlegements

Compiler vs. transpiler: https://stackoverflow.com/a/44932758/8190832
